# Лекция 8

Цитата дня:
 _Опыт - он бесценен (с) А.В Маятин_

## Монолог за _надежность_.

Основная задача бд - хранение

Если мы говорим про **надежность** бд, то мы говорим про:

1. Надёжность хранения - если мы единожды сохранили данные, то через любой промежуток времени, через который мы прочитаем эти данные, данные окажутся теми же

2. Надёжность доступа - блокировка данных при высокой нагрузке

Мы рассматриваем надежность как обеспечение целостности и надежности данных на всем промежутке использования **ИС**.

    СХД - система хранения данных

## Виды целостости данных

1. Физическая целостность _(стандарт TIER)_

2. Логическая целостность _(сложно контроллировать)_


## Транзакция

Транзакция - последовательность действий с бд, в которой либо все действия выполняются успешно, либо не выполняется ниодно из них.

Транзакция - преобразование бд в промежутке которого она может быть не в согласованном состоянии

Транзакция имеет два результата:

1) Commit - все успешно
2) Rollback - если хотя бы одна операция не прошла

### Свойства транзакций

1) **Атомарность транзакций** - транзакция неделима, в транзакции выполняются либо все действия либо ниодного

2) **Согласованность** - Транзакция переводит одно согласованное состояние бд в другое без соблюдениня обязательного согласования в промежуточных точках

3) **Изоляция** - если заупещнно несколько конкурирующих транзакций то любое обновление выполненное одной транзакцией, скрыто от других до ее завершения

4) **Долговечность** - когда транзакция завершена, ее результаты обновления сохраняются даже если в следующий момент произойдет сбой.

## Проблемы конкурирующих транзакций

1) **Проблема потерянного обновления** - несколько транзакций меняют один и тот же кортеж, в резульатет сохранится только результат внесения транзакций

2) **Проблема грязного чтения** - возникает при чтении одной транзакции кортежа который уже изменен, но еще не сохранен другой незавершившейся транзакции которая отменена.

3) **Проблема неповторяемого чтения** - при повторном чтении данных, уже считанных ранее **транзакция** обнаруживает модификацию вызванную другой завершенной **транзакции**

4) **Фантомное чтение** - 


### Блокировки 

Все транзакции строятся на основе блокировок:

1) Блок кортежей
2) Блок таблиц
3) Блок аттрибутов 

**Блокировки** могут **накладываться** :

1) Из приложение (**явные** блокировки) 
2) Которые накладываются самой СУБД (**неявные**)

**Блокировки** могут быть:

1) Монопольные (блокируются все виды доступа к обьектам)
2) Коллективные (длокируется доступ к чтению обьектов)

### Для решения проблем с транзакциями придумали 4 уровня изоляции:

_От слабого -> к сильному:_

1) **Незавершенное чтение** - изменять данные может только одна транзакция 

    **Спасает от**: потерянного обновления

2) **Завершенное чтение** - если транзакция начала изменения данных, то никакая другая транзакция не сможет их прочитать до завершения первой.

    **Спасает от**: грязное чтение

3) **Воспроизводимое чтение** - если транзакция считывает данные, то никкая другая не сможет их изменить до завершения первой

    **Спасает от**: непвторяемое чтение
4) **Сериализуемость** - если транзакция обращается к данным то ниодна транзакция не сможет добавить новые или изменить существующие кортежи в этом обьекте данных

    **Спасает от**: от всего

